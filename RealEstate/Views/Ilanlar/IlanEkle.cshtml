@model DTOLayer.IlanModelDTO;
<link rel="stylesheet" href="~/lib/bootstrap-selectize/selectize.min.css" />
<style>

.wrapper{
  display: inline-flex;
  background: #fff;
  height: 100px;
  width: 400px;
  align-items: center;
  justify-content: space-evenly;
  border-radius: 5px;
  padding: 20px 15px;
}
.wrapper .option{
  background: #fff;
  width: 40%;
  display: flex;
  align-items: center;
  justify-content: space-evenly;
  margin: 0 10px;
  border-radius: 5px;
  cursor: pointer;
  padding: 0 10px;
  border: 2px solid lightgrey;
  transition: all 0.3s ease;
}
.wrapper .option .dot{
  height: 20px;
  width: 20px;
  background: #d9d9d9;
  border-radius: 50%;
  position: relative;
}
.wrapper .option .dot::before{
  position: absolute;
  content: "";
  top: 4px;
  left: 4px;
  width: 12px;
  height: 12px;
  background: #0069d9;
  border-radius: 50%;
  opacity: 0;
  transform: scale(1.5);
  transition: all 0.3s ease;
}
input[type="radio"]{
  display: none;
}
#option-1:checked:checked ~ .option-1,
#option-2:checked:checked ~ .option-2,
#yeniSatici:checked:checked ~ .yeniSatici,
#kayitliSatici:checked:checked ~ .kayitliSatici,
#Satilik:checked:checked ~ .Satilik,
#Kiralik:checked:checked ~ .Kiralik {
  border-color: #4CB9E7;
  background: #4CB9E7;
}
#option-1:checked:checked ~ .option-1 .dot,
#option-2:checked:checked ~ .option-2 .dot,
#yeniSatici:checked:checked ~ .yeniSatici .dot,
#kayitliSatici:checked:checked ~ .kayitliSatici .dot,
#Satilik:checked:checked ~ .Satilik .dot,
#Kiralik:checked:checked ~ .Kiralik .dot {
  background: #fff;
}
#option-1:checked:checked ~ .option-1 .dot::before,
#option-2:checked:checked ~ .option-2 .dot::before,
#yeniSatici:checked:checked ~ .yeniSatici .dot::before,
#kayitliSatici:checked:checked ~ .kayitliSatici .dot::before,
#Satilik:checked:checked ~ .Satilik .dot::before,
#Kiralik:checked:checked ~ .Kiralik .dot::before{
  opacity: 1;
  transform: scale(1);
}
.wrapper .option span{
  font-size: 20px;
  color: #808080;
}
#option-1:checked:checked ~ .option-1 span,
#option-2:checked:checked ~ .option-2 span,
#yeniSatici:checked:checked ~ .yeniSatici span,
#kayitliSatici:checked:checked ~ .kayitliSatici span,
#Satilik:checked:checked ~ .Satilik span,
#Kiralik:checked:checked ~ .Kiralik span {
  color: #fff;
}

.selectize-input.items.not-full.has-options::after{
    display:none;
}

</style>

<form class="mt-4 ml-4 mb-4" asp-controller="ilanlar" asp-action="ilanekle" method="post">
    <div class="form-group">
        <div class="wrapper">
            <input asp-for="RadioForSatici" type="radio" name="radioForSatici" value="1" id="yeniSatici" checked>
            <input asp-for="RadioForSatici" type="radio" name="radioForSatici" value="0" id="kayitliSatici">
            <label for="yeniSatici" class="option yeniSatici">
                <span>Yeni müşteri</span>
            </label>
            <label for="kayitliSatici" class="option kayitliSatici">
                <span>Kayıtlı müşteri</span>
            </label>
        </div>

        <div id="EskiSaticiDiv" style="display:none;">
            <label for="exampleFormControlInput1">Satıcı Seçiniz</label>
            <select asp-for="SaticiId" id="select-satici" placeholder="Satıcı seçiniz">
                @await Component.InvokeAsync("MusteriGetirComponent", new {userId = ViewBag.userId})
            </select>
            <small class="text-danger">Not: Aynı isimde müşteriler olabilir. Telefon numarası bu konuda ayırt edici olabilir.</small>
        </div>

        <div id="YeniSaticiDiv">
            <div class="form-group">
                <span asp-validation-for="SaticiIsimSoyisim"></span>
                <br />
                <label>Satıcı isim soyisim</label>
                <input asp-for="SaticiIsimSoyisim" type="text" class="form-control" placeholder="İsim soyisim">
            </div>
            <div class="form-group">
                <span asp-validation-for="SaticiMail"></span>
                <br />
                <label>Satıcı mail adresi</label>
                <input asp-for="SaticiMail" type="email" class="form-control" aria-describedby="emailHelp" placeholder="Mail adresi">
            </div>
            <div class="form-group">
                <span asp-validation-for="SaticiTelNo"></span>
                <br />
                <label>Satıcı telefon numarası</label>
                <input asp-for="SaticiTelNo" type="tel" class="form-control" placeholder="Telefon numarası" pattern="[0-9]{3}[0-9]{3}[0-9]{2}[0-9]{2}">
            </div>
        </div>
    </div>
    <hr />
    <div class="form-group">
        <span asp-validation-for="IlanBaslik"></span>
        <br />
        <label>İlan Başlık</label>
        <input asp-for="IlanBaslik" type="text" class="form-control" placeholder="İlan Başlık">
    </div>
    <hr />
    <div class="d-grid">
        <div class="row">
            
            <div class="form-group">
                <label>İlan Tipi</label>
                <select asp-for="IlanTipi" class="form-control" id="ilanTipiInput" data-portfoy="[1,2,3,4,5]">
                    <option value="2">Arsa</option>
                    <option value="4">Tarla</option>
                    <option value="1">Dükkan</option>
                    <option value="5">Daire</option>
                    <option value="3">Depo</option>
                </select>
            </div>
            <div class="form-group">
                <label>Metrekare Net</label>
                <input asp-for="MetrekareNet" id="metrekarenet" type="number" class="form-control" data-portfoy="[1,2,3,4,5]">
            </div>
            <div class="form-group">
                <label>Metrekare Brüt</label>
                <input asp-for="MetrekareBrut" type="number" class="form-control" data-portfoy="[1,5]">
            </div>
            <div class="form-group">
                <label>Ada No</label>
                <input asp-for="AdaNo" type="number" class="form-control" data-portfoy="[1,2,3,4,5]">
            </div>
            <div class="form-group">
                <label>Pafta No</label>
                <input asp-for="PaftaNo" type="number" class="form-control" data-portfoy="[2,4]">
            </div>
            <div class="form-group">
                <label>Parsel No</label>
                <input asp-for="ParselNo" type="number" class="form-control" data-portfoy="[1,2,3,4,5]">
            </div>
            <div class="form-group">
                <label>İmar durumu</label>
                <select asp-for="ImarDurumu" class="form-control" data-portfoy="[2,4]">
                    <option value="1">Var</option>
                    <option value="0">Yok</option>
                </select>
            </div>
            <div class="form-group">
                <label>Kat karşılığına uygun mu?</label>
                <select asp-for="KatKarsiliginaUygun" class="form-control" data-portfoy="[2]">
                    <option value="1">Evet</option>
                    <option value="0">Hayır</option>
                </select>
            </div>
            <div class="form-group">
                <label>Oda sayısı</label>
                <select asp-for="OdaSayisi" class="form-control" data-portfoy="[1,5]">
                    <option value="1+0 (Stüdyo)">1+0 (Stüdyo)</option>
                    <option value="1+1">1+1</option>
                    <option value="2+0">2+0</option>
                    <option value="2+1">2+1</option>
                    <option value="2+2">2+2</option>
                    <option value="2.5+1">2.5+1</option>
                    <option value="3+1">3+1</option>
                    <option value="3.5+1">3.5+1</option>
                    <option value="3+2">3+2</option>
                    <option value="3+3">3+3</option>
                    <option value="4+0">4+0</option>
                    <option value="4+1">4+1</option>
                    <option value="4.5+1">4.5+1</option>
                    <option value="4+2">4+2</option>
                    <option value="4+3">4+3</option>
                    <option value="4+4">4+4</option>
                    <option value="5+1">5+1</option>
                    <option value="5.5+1">5.5+1</option>
                    <option value="5+2">5+2</option>
                    <option value="5+3">5+3</option>
                    <option value="5+4">5+4</option>
                    <option value="6+1">6+1</option>
                    <option value="6+2">6+2</option>
                    <option value="6+3">6+3</option>
                    <option value="6+4">6+4</option>
                    <option value="7+1">7+1</option>
                    <option value="7+2">7+2</option>
                    <option value="7+3">7+3</option>
                    <option value="8+1">8+1</option>
                    <option value="8+2">8+2</option>
                    <option value="8+3">8+3</option>
                    <option value="8+4">8+4</option>
                    <option value="9+1">9+1</option>
                    <option value="9+2">9+2</option>
                    <option value="9+3">9+3</option>
                    <option value="9+4">9+4</option>
                    <option value="9+5">9+5</option>
                    <option value="9+6">9+6</option>
                    <option value="9 üzeri">9 üzeri</option>
                </select>
            </div>
            <div class="form-group">
                <label>Bina yaşı</label>
                <input asp-for="BinaYasi" type="number" class="form-control" data-portfoy="[1,5]">
            </div>
            <div class="form-group">
                <label>Bulunduğu kat</label>
                <input asp-for="BulunduguKat" type="number" class="form-control" data-portfoy="[1,5]">
            </div>
            <div class="form-group">
                <label>Kat sayısı</label>
                <input asp-for="KatSayisi" type="number" class="form-control" data-portfoy="[1,5]">
            </div>
            <div class="form-group">
                <label>Isıtma</label>
                <select asp-for="Isıtma" class="form-control" data-portfoy="[1,5]">
                    <option value="Doğalgaz">Doğalgaz</option>
                    <option value="Merkezi">Merkezi</option>
                    <option value="Soba">Soba</option>
                </select>
            </div>
            <div class="form-group">
                <label>Banyo sayısı</label>
                <input asp-for="BanyoSayisi" type="number" class="form-control" data-portfoy="[5]">
            </div>
            <div class="form-group">
                <label>Balkon sayısı</label>
                <input asp-for="BalkonSayisi" type="number" class="form-control" data-portfoy="[5]">
            </div>
            <div class="form-group">
                <label>Asansör</label>
                <select asp-for="Asansor" class="form-control" data-portfoy="[1,5]">
                    <option value="1">Var</option>
                    <option value="0">Yok</option>
                </select>
            </div>
            <div class="form-group">
                <label>Otopark</label>
                <select asp-for="Otopark" class="form-control" data-portfoy="[1,5]">
                    <option value="1">Var</option>
                    <option value="0">Yok</option>
                </select>
            </div>
            <div class="form-group">
                <label>Eşyalı mı?</label>
                <select asp-for="Esyali" class="form-control" data-portfoy="[1,5]">
                    <option value="1">Evet</option>
                    <option value="0">Hayır</option>
                </select>
            </div>
            <div class="form-group">
                <label>Kullanım durumu</label>
                <select asp-for="KullanimDurumu" class="form-control" data-portfoy="[1,5]">
                    <option value="Kullanımda">Kullanımda</option>
                    <option value="Kullanılmıyor">Kullanılmıyor</option>
                </select>
            </div>
            <div class="form-group">
                <label>Site mi?</label>
                <select asp-for="SiteMi" class="form-control" data-portfoy="[5]">
                    <option value="1">Evet</option>
                    <option value="0">Hayır</option>
                </select>
            </div>
            <div class="form-group">
                <label>Krediye uygun mu?</label>
                <select asp-for="KrediyeUygun" class="form-control" data-portfoy="[1,5]">
                    <option value="1">Evet</option>
                    <option value="0">Hayır</option>
                </select>
            </div>
            <div class="form-group">
                <label>Aidat</label>
                <input asp-for="Aidat" type="number" class="form-control" data-portfoy="[1,5]" />
            </div>
            <div class="form-group">
                <label>Tapu durumu</label>
                <select asp-for="TapuDurumu" class="form-control" data-portfoy="[2,4]">
                    <option value="1">Var</option>
                    <option value="0">Yok</option>
                </select>
            </div>
        </div>
        <hr />
        <div class="row">
            <div class="form-group">
                <label>Şehir</label>
                <select class="form-control" asp-for="Sehir" id="selectCity" data-portfoy="[1,2,3,4,5]">
                </select>
            </div>

            <div class="form-group">
                <label>İlçe</label>
                <select class="form-control" asp-for="Semt" id="selectTown" data-portfoy="[1,2,3,4,5]">
                </select>
            </div>

            <div class="form-group">
                <label>Mahalle/Köy</label>
                <select class="form-control" asp-for="Mahalle" id="selectMahalle" data-portfoy="[1,2,3,4,5]">
                </select>
            </div>
        </div>
    </div>
    <hr />
    
    
    <div class="form-group">
        <label>Fiyat</label>
        <input asp-for="Fiyat" type="number" class="form-control w-25" id="fiyat" />
    </div>
    <div>
        Metrekare Fiyat = <span id="metrekarefiyat"></span>
    </div>
    <div class="form-group">
        <label>Satılık / Kiralık</label>
        <div class="wrapper">
            <input asp-for="SatilikMiKiralikMi" type="radio" name="SatilikMiKiralikMi" value="1" id="Satilik" checked>
            <input asp-for="SatilikMiKiralikMi" type="radio" name="SatilikMiKiralikMi" value="0" id="Kiralik">
            <label for="Satilik" class="option Satilik">
                <span>Satılık</span>
            </label>
            <label for="Kiralik" class="option Kiralik">
                <span>Kiralık</span>
            </label>
        </div>
    </div>
    <div class="form-group">
        <label>Komisyon</label>
        <div class="wrapper">
            <input asp-for="radioForKomisyon" type="radio" name="radioForKomisyon" value="1" id="option-1" checked>
            <input asp-for="radioForKomisyon" type="radio" name="radioForKomisyon" value="0" id="option-2">
            <label for="option-1" class="option option-1">
                <span style="font-size:14px; text-align:center;">Varsayılan<br />(Satılık: %4, Kiralık: Bir kira bedeli)</span>
            </label>
            <label for="option-2" class="option option-2" style="height:63px;">
                <span>Özel</span>
            </label>
        </div>
        <br />
        <span id="komisyon"></span>
        <input asp-for="Komisyon" type="number" style="display:none;" placeholder="Komisyon bedeli" class="form-control w-25" id="ozelKomisyon" />
    </div>
    
    <div class="form-group">
        <label>Diğer detaylar</label>
        <textarea asp-for="Detaylar" class="form-control" placeholder="Diğer detaylar..."></textarea>
    </div>
    <div class="form-group">
        <input type="submit" class="form-control btn w-25" style="background-color:#4CB9E7;color:#ffffff;" value="İlan ekle" />
    </div>
    @if (ViewBag.error != null)
    {
        <div id="errorDiv" class="bg-danger">
            @ViewBag.error
        </div>

        <script>
            setTimeout(() => {
                $("#errorDiv").fadeOut();
            }, 5000);
        </script>
    }
</form>

<script>
    var turkiye={};
    fetch("https://raw.githubusercontent.com/nejdetkadir/il-ilce-semt-mahalleler/master/data/data.json")
        .then(res => res.json())
        .then(datas => {
            turkiye=datas;
            let cities = turkiye.map(data => data.name);
            let options = "<option value='0' checked>Şehir seçiniz.</option>";
            cities.forEach(city => options += `<option value='${city}'>${city}</option>`)
            $("#selectCity").html(options);
        })

    $("#selectCity").change(() => {
        let cityname = $("#selectCity").val();
        let cityObject = turkiye.filter(city => city.name == cityname)[0];
        let towns=cityObject.towns;
        let townNames = towns.map(town => town.name);
        let options = "<option value='0' checked>Semt seçiniz.</option>";
        townNames.forEach(townName => options += `<option value='${townName}'>${townName}</option>`);
        $("#selectTown").html(options);
    });

    $("#selectTown").change(() => {
        let cityname = $("#selectCity").val();
        let cityObject = turkiye.filter(city => city.name == cityname)[0];
        let townname = $("#selectTown").val();
        let townObject = cityObject.towns.filter(town => town.name == townname)[0];
        let mahalleler = townObject.districts;
        let options = "<option value='0' checked>Köy/Mahalle seçiniz.</option>";
        let mahallelerOptions=[];
        mahalleler.forEach(mahalle=>{
            mahalle.quarters.forEach(quarter=>{
                mahallelerOptions.push(`${quarter.name} ${mahalle.name != 'Köyler' ? ','+mahalle.name : ''}`)
            })
        });
        mahallelerOptions.forEach(mahalle => options += `<option value='${mahalle}'>${mahalle}</option>`);
        $("#selectMahalle").html(options);
    })

    $(document).ready(function () {
        portfoyForm();
        $("input[name='radioForSatici']").change(()=>{
            if ($('#yeniSatici').is(':checked')){
                $("#YeniSaticiDiv").fadeIn();
                $("#EskiSaticiDiv").fadeOut();
            }
            else{
                $("#YeniSaticiDiv").fadeOut();
                $("#EskiSaticiDiv").fadeIn();
            }
        });

        $("input[name='radioForKomisyon']").change(() => {
            if ($('#option-1').is(':checked')) {
                $("#ozelKomisyon").css("display", "none");
                $("#komisyon").css("display", "block");
            }
            else {
                $("#komisyon").css("display","none");
                $("#ozelKomisyon").css("display","block");
            }
        });

        $('#select-satici').selectize({
          sortField: 'text'
        });

        $("#ilanTipiInput").change(()=>{
            portfoyForm();
        });

        $("#fiyat").on("keyup", () => {
            if($("input[name='SatilikMiKiralikMi']").val()=="1"){
                $("#komisyon").html("Komisyon: " + parseInt($("#fiyat").val()) * 4 / 100);
            }
            else{
                $("#komisyon").html("Komisyon: " + $("#fiyat").val());
            }
            
            $("#metrekarefiyat").html(parseInt($("#fiyat").val()) / parseInt($("#metrekarenet").val()));
        });

        $("#metrekarenet").on("keyup", () => {
            $("#metrekarefiyat").html(parseInt($("#fiyat").val()) / parseInt($("#metrekarenet").val()));
        })

    });

    function portfoyForm(){
        var val = $("#ilanTipiInput").val();
        console.log(typeof (val));
        $(".d-grid .form-control").each((index, element) => {
            var dataPortfoy = JSON.parse(element.getAttribute("data-portfoy"));
            if (dataPortfoy.includes(parseInt(val))) {
                element.parentElement.style.display = "block";
            }
            else {
                element.parentElement.style.display = "none";
            }
        });
    }


</script>
<script src="~/lib/jquery-selectize/selectize.min.js"></script>