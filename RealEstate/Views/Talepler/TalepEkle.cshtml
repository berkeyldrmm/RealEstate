<link rel="stylesheet" href="~/lib/bootstrap-selectize/selectize.min.css" />
<style>

    .wrapper {
        display: inline-flex;
        background: #fff;
        height: 100px;
        width: 400px;
        align-items: center;
        justify-content: space-evenly;
        border-radius: 5px;
        padding: 20px 15px;
    }

        .wrapper .option {
            background: #fff;
            width: 40%;
            display: flex;
            align-items: center;
            justify-content: space-evenly;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            padding: 0 10px;
            border: 2px solid lightgrey;
            transition: all 0.3s ease;
        }

            .wrapper .option .dot {
                height: 20px;
                width: 20px;
                background: #d9d9d9;
                border-radius: 50%;
                position: relative;
            }

                .wrapper .option .dot::before {
                    position: absolute;
                    content: "";
                    top: 4px;
                    left: 4px;
                    width: 12px;
                    height: 12px;
                    background: #0069d9;
                    border-radius: 50%;
                    opacity: 0;
                    transform: scale(1.5);
                    transition: all 0.3s ease;
                }

    input[type="radio"] {
        display: none;
    }

    #option-1:checked:checked ~ .option-1,
    #option-2:checked:checked ~ .option-2,
    #yeniSatici:checked:checked ~ .yeniSatici,
    #kayitliSatici:checked:checked ~ .kayitliSatici,
    #Satilik:checked:checked ~ .Satilik,
    #Kiralik:checked:checked ~ .Kiralik {
        border-color: #0077b6;
        background: #0077b6;
    }

        #option-1:checked:checked ~ .option-1 .dot,
        #option-2:checked:checked ~ .option-2 .dot,
        #yeniSatici:checked:checked ~ .yeniSatici .dot,
        #kayitliSatici:checked:checked ~ .kayitliSatici .dot,
        #Satilik:checked:checked ~ .Satilik .dot,
        #Kiralik:checked:checked ~ .Kiralik .dot {
            background: #fff;
        }

            #option-1:checked:checked ~ .option-1 .dot::before,
            #option-2:checked:checked ~ .option-2 .dot::before,
            #yeniSatici:checked:checked ~ .yeniSatici .dot::before,
            #kayitliSatici:checked:checked ~ .kayitliSatici .dot::before,
            #Satilik:checked:checked ~ .Satilik .dot::before,
            #Kiralik:checked:checked ~ .Kiralik .dot::before {
                opacity: 1;
                transform: scale(1);
            }

    .wrapper .option span {
        font-size: 20px;
        color: #808080;
    }

    #option-1:checked:checked ~ .option-1 span,
    #option-2:checked:checked ~ .option-2 span,
    #yeniSatici:checked:checked ~ .yeniSatici span,
    #kayitliSatici:checked:checked ~ .kayitliSatici span,
    #Satilik:checked:checked ~ .Satilik span,
    #Kiralik:checked:checked ~ .Kiralik span {
        color: #fff;
    }

    .selectize-input.items.not-full.has-options::after {
        display: none;
    }

    .flex-wrap input {
        width: 20px;
        height: 20px;
    }

    .flex-wrap div {
        margin-right:20px;
        font-size:20px;
    }
</style>

<form class="mt-4 ml-4 mb-4">
    <div class="form-group">
        <div class="wrapper">
            <input type="radio" name="radioForAlici" value="1" id="yeniSatici" checked>
            <input type="radio" name="radioForAlici" value="0" id="kayitliSatici">
            <label for="yeniSatici" class="option yeniSatici">
                <span>Yeni müşteri</span>
            </label>
            <label for="kayitliSatici" class="option kayitliSatici">
                <span>Kayıtlı müşteri</span>
            </label>
        </div>

        <div id="EskiSaticiDiv" style="display:none;">
            <label>Satıcı Seçiniz</label>
            <select id="select-alici" placeholder="Satıcı seçiniz">
                @await Component.InvokeAsync("MusteriGetirComponent", new {userId = ViewBag.userId})
            </select>
            <small class="text-danger">Not: Aynı isimde müşteriler olabilir. Telefon numarası bu konuda ayırt edici olabilir.</small>
        </div>

        <div id="YeniSaticiDiv">
            <div class="form-group">
                <br />
                <label>Alıcı isim soyisim</label>
                <input type="text" name="aliciIsimSoyisim" class="form-control" placeholder="İsim soyisim">
            </div>
            <div class="form-group">
                <br />
                <label>Alıcı mail adresi</label>
                <input type="email" name="aliciMail" class="form-control" aria-describedby="emailHelp" placeholder="Mail adresi">
            </div>
            <div class="form-group">
                <br />
                <label>Alıcı telefon numarası</label>
                <input type="tel" name="aliciTelNo" class="form-control" placeholder="Telefon numarası" pattern="[0-9]{3}[0-9]{3}[0-9]{2}[0-9]{2}">
            </div>
        </div>
    </div>
    <hr />
    <div class="d-grid">
        <div class="row w-100">
            <div class="form-group w-25">
                <label>İlan Tipi</label>
                <select class="form-control" id="ilanTipiInput" data-portfoy="[1,2,3,4,5]">
                    <option value="2">Arsa</option>
                    <option value="4">Tarla</option>
                    <option value="1">Dükkan</option>
                    <option value="5">Daire</option>
                    <option value="3">Depo</option>
                </select>
            </div>
            <div class="form-group w-50" id="odaSayisi" data-portfoy="[1,5]">
                <label for="odaSayisi" style="font-size:20px;">Oda sayısı</label>
                <div class="d-flex flex-wrap">
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="1+0" />1+0 (Stüdyo)</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="1+1" />1+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="2+0" />2+0</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="2+1" />2+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="2+2" />2+2</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="2.5+1" />2.5+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="3+0" />3+0</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="3+1" />3+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="3.5+1" />3.5+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="3+2" />3+2</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="3+3" />3+3</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="4+0" />4+0</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="4+1" />4+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="4.5+1" />4.5+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="4+2" />4+2</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="4+3" />4+3</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="4+4" />4+4</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="5+1" />5+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="5.5+1" />5.5+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="5+2" />5+2</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="5+3" />5+3</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="5+4" />5+4</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="6+1" />6+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="6+2" />6+2</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="6+3" />6+3</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="6+4" />6+4</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="7+1" />7+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="7+2" />7+2</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="7+3" />7+3</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="8+1" />8+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="8+2" />8+2</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="8+3" />8+3</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="8+4" />8+4</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="9+1" />9+1</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="9+2" />9+2</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="9+3" />9+3</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="9+4" />9+4</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="9+5" />9+5</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="9+6" />9+6</div>
                    <div><input type="checkbox" class="form-check-input" name="odaSayisi" value="9 ve üzeri" />9 ve üzeri</div>
                </div>
            </div>
        </div>
        <hr />
        <div class="row">
            <div class="form-group">
                <label>Şehir</label>
                <select class="form-control" id="selectCity" data-portfoy="[1,2,3,4,5]">
                </select>
            </div>

            <div class="form-group d-flex flex-wrap" id="selectTown">
            </div>

        </div>
    </div>
    <hr />

    <div class="form-group">
        <label>Minimum Fiyat</label>
        <input type="number" class="form-control w-25" id="minFiyat" />
    </div>
    <div class="form-group">
        <label>Maksimum Fiyat</label>
        <input type="number" class="form-control w-25" id="maxFiyat" />
    </div>
    <div class="form-group">
        <label>Satılık / Kiralık</label>
        <div class="wrapper">
            <input type="radio" name="SatilikMiKiralikMi" value="1" id="Satilik" checked>
            <input type="radio" name="SatilikMiKiralikMi" value="0" id="Kiralik">
            <label for="Satilik" class="option Satilik">
                <span>Satılık</span>
            </label>
            <label for="Kiralik" class="option Kiralik">
                <span>Kiralık</span>
            </label>
        </div>
    </div>

    <div class="form-group">
        <label>Diğer detaylar</label>
        <textarea id="detaylar" class="form-control" placeholder="Diğer detaylar..."></textarea>
    </div>
    <div class="form-group">
        <input type="submit" id="talepEkle" class="form-control btn w-25" style="background-color:#0077b6;color:#ffffff;" value="Talep ekle" />
    </div>

    <div id="errorDiv" class="bg-danger" style="display:none;">
        Talep eklenirken bir hata oluştu
    </div>

    <script>
        setTimeout(() => {
            $("#errorDiv").fadeOut();
        }, 5000);
    </script>
    
</form>

<script>
    var turkiye = {};
    

    $(document).ready(function () {
        fetch("https://raw.githubusercontent.com/nejdetkadir/il-ilce-semt-mahalleler/master/data/data.json")
        .then(res => res.json())
        .then(datas => {
            turkiye = datas;
            let cities = turkiye.map(data => data.name);
            let options = "<option value='0' checked>Şehir seçiniz.</option>";
            cities.forEach(city => options += `<option value='${city}'>${city}</option>`)
            $("#selectCity").html(options);
        })

        $("#selectCity").change(() => {
            let cityname = $("#selectCity").val();
            let cityObject = turkiye.filter(city => city.name == cityname)[0];
            let towns = cityObject.towns;
            let townNames = towns.map(town => town.name);
            let options = "<label style='font-size:20px;'>İlçe/Semt</label><br/>";
            townNames.forEach(townName => options += `<div><input type='checkbox' class="form-check-input" name='Semt' value='${townName}' data-portfoy='[1,2,3,4,5]' />${townName}</div> `);
            $("#selectTown").html(options);
        });

        $("#talepEkle").on("click",(e)=>{
            e.preventDefault();

            const radioForAlici = $("input[name='radioForAlici']:checked").val();
            const aliciId = $("#select-alici").val();
            const aliciIsimSoyisim = $("input[name='aliciIsimSoyisim']").val();
            const aliciTelNo = $("input[name='aliciTelNo']").val();
            const aliciMail = $("input[name='aliciMail']").val();
            const ilanTipi = $("#ilanTipiInput").val();
            const satilikMiKiralikMi = $("input[name='SatilikMiKiralikMi']:checked").val();
            const sehir = $("#selectCity").val();
            const minFiyat = $("#minFiyat").val();
            const maxFiyat = $("#maxFiyat").val();
            const detaylar = $("textarea#detaylar").val();

            var odaSayisi = [];
            var odaSayisiOptions = $("input[name='odaSayisi']");
            odaSayisiOptions.each((index, value) => {
                if (value.checked) {
                    odaSayisi.push(value.value);
                }
            });

            var semt = [];
            var semtOptions = $("input[name='Semt']");
            semtOptions.each((index, value) => {
                if (value.checked) {
                    semt.push(value.value);
                }
            });

            $.post("https://localhost:7191/talepler/talepekle", {talepJson : JSON.stringify({
                "radioForAlici": radioForAlici,
                "aliciId": aliciId,
                "aliciIsimSoyisim": aliciIsimSoyisim,
                "aliciTelNo": aliciTelNo,
                "aliciMail": aliciMail,
                "ilanTipi": ilanTipi,
                "satilikMiKiralikMi": satilikMiKiralikMi,
                "sehir": sehir,
                "semt": semt,
                "odaSayisi": odaSayisi,
                "minFiyat": minFiyat,
                "maxFiyat": maxFiyat,
                "detaylar": detaylar
            }
                )
            }).done((data, status) => {
                if (status = "success") {
                    window.location.href = "https://localhost:7191/talepler/";
                }
                else {
                    $("#errorDiv").fadeIn(5000, () => {
                        setTimeout(() => {
                            $("#errorDiv").fadeIn();
                        }, 5000);
                    })

                }
            }).fail((xhr,status,error)=>{
                $("#errorDiv").html(status+" - "+error);
            })
        });

        portfoyForm();
        $("input[name='radioForAlici']").change(() => {
            if ($('#yeniSatici').is(':checked')) {
                $("#YeniSaticiDiv").fadeIn();
                $("#EskiSaticiDiv").fadeOut();
            }
            else {
                $("#YeniSaticiDiv").fadeOut();
                $("#EskiSaticiDiv").fadeIn();
            }
        });


        $('#select-alici').selectize({
            sortField: 'text'
        });

        $("#ilanTipiInput").change(() => {
            portfoyForm();
        });

    });

    function portfoyForm() {
        let val = $("#ilanTipiInput").val();
        let odalar = $("#odaSayisi");
        let dataPortfoy = JSON.parse($("#odaSayisi").attr("data-portfoy"));
        if (dataPortfoy.includes(parseInt(val))) {
            odalar.css("display","block");
        }
        else {
            odalar.css("display", "none");
        }

    }


</script>
<script src="~/lib/jquery-selectize/selectize.min.js"></script>